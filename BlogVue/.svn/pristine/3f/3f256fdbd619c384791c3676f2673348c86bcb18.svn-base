<template>
  <div id="app">
    <left-menu :showType="showType" :pathList3="pathList3"></left-menu>
    <transition :name="!isBack?'fade':'back'" :mode="!isBack?'out-in':'in-out'">
      <router-view class="wrap-main" v-if="isRouterAlive &&isReady"></router-view>
    </transition>
  </div>
</template>

<script>
import leftMenu from "./frame/leftmenu.vue";
export default {
  components: { leftMenu },
  name: "app",
  data() {
    return {
      isRouterAlive: true,
      isBack: false,

      isReady: false, //接口请求后再出现页面

      pathList: [],
      showType: 0,

      pathList1: [
        { name: "作业讲解", id: "2", path: "/myfile", icon: "icon-people" }
      ],
      pathList2: [
        {
          name: "作业讲解",
          id: "2",
          path: "/stuanalysis",
          icon: "icon-people"
        }
      ],
      pathList3: []
    };
  },
  created() {},
  mounted() {
    // var url='http://basedebug.bestsch.com/BschQuestionnaire/api/GetUserInfo';
    //  $.ajax({
    //     type: "GET",
    //     url: url,
    //     data: null,
    //     dataType: 'json',
    //     xhrFields:{ withCredentials: true },
    //     crossDomain: true,
    //     headers: {
    //         bschapirequest:1,
    //         "content-type":"application/json"
    //     },
    //     success: function(resp){
    //       if (resp.code == 302)
    //           {
    //           console.log(resp.urlToRedirectTo)
    //           // var url = resp.urlToRedirectTo
    //           // window.location.href = url
    //           }else{
    //               // _this.$Message.info("修改成功");
    //           }
    //       },
    // });
    this.getUserInfo();
  },
  watch: {
    $route(router) {
      if (router.path == "/user/back") {
        this.isBack = true;
      } else {
        this.isBack = false;
      }
    }
  },
  methods: {
    reload() {
      this.isRouterAlive = false;
      this.$nextTick(() => {
        this.isRouterAlive = true;
        this.$router.replace("");
      });
    },

    getUserInfo() {
      //获取用户信息
      const _this = this;
      let path = "";
      _this.$api.get(APIConfig.Base.GetUserInfo, null, function(resp) {
        if (resp.code == 0) {
          let usr = resp.data;
          _this.pathList = [];
          if (typeof resp.data.roleIds.find(item => item == 1) != "undefined") {
            // console.log("教师身份");
            _this.showType = 0;
            _this.$set(usr, "myUserType", 1);
            _this.$store.commit("setcurUser", usr);
            _this.pathList.push({
              name: "小讨论",
              id: "21",
              path: "/discussionManager",
              icon: "icontaolun",
              children: [
                {
                  name: "讨论管理",
                  id: "21",
                  path: "/discussionManager",
                  icon: ""
                },
                {
                  name: "发布管理",
                  id: "22",
                  path: "/dReleManager",
                  icon: ""
                }
              ]
            });
            _this.pathList3 = _this.pathList1;
            path = "/discussionManager";
            // _this.$router.push(_this.pathList[0].children[0].path);
          } else if (
            typeof resp.data.roleIds.find(item => item == 3) != "undefined"
          ) {
            _this.showType = 1;
            _this.$set(usr, "myUserType", 0);
            _this.$store.commit("setcurUser", usr);
            //学生
            _this.pathList.push({
              name: "我的讨论",
              id: "23",
              path: "/stuDiscussion",
              icon: "icontaolun",
              children: []
            });
            path = "/stuDiscussion";
            _this.pathList3 = _this.pathList2;
          }
          _this.isReady = true;
          var paa = window.location.href.split("#")[1];
          if (paa == "/" || paa == "/discussion/") {
            _this.$router.push(path);
          }
        } else {
          _this.$Message.info(resp.Message);
        }
      });
    }
  }
};
</script>


<style lang="scss">
#loging-box,
.mop-load-div {
  display: none;
}
/* 开始过渡阶段,动画出去阶段 */
.fade-enter-active,
.fade-leave-active {
  transition: all 1ms cubic-bezier(0, 0.99, 1, 0.03);
}
/* 进入开始 */
.fade-enter {
  // transform: translateY(10px);
  opacity: 0;
}
/* 出去终点 */
.fade-leave-active {
  // transform: translateY(-10px);
  // opacity: 0;
}

.back-enter-active,
.back-leave-active {
  transition: all 1ms cubic-bezier(0, 0.99, 1, 0.03);
}
/* 进入开始 */
.back-enter {
  display: none;
}
/* 出去终点 */
.back-leave-active {
  display: none;
}
#app {
  height: 100%;
}

// @media screen and (max-width: 1366px) {
//   html{
//     zoom: 0.8;
//   }
// }
</style>